# POWER Maintainer: Alexander Baldeck <alex.bldck@gmail.com>

pkgname=libjnidispatch
pkgver=5.5.0
pkgrel=1
pkgdesc="Java Native Access - native bits"
arch=(x86_64 powerpc64le)
url="https://www.elastic.co/products/elasticsearch"
license=('Apache')
depends=('glibc')
makedepends=('jdk8-openjdk' 'ant')
provides=('libjnidispatch.so')
options=(!makeflags)
docker_priv=1
source=(
  "git+https://github.com/java-native-access/jna.git?#tag=${pkgver}"
  jna-ant.patch
  jna-gcc-10.patch
)
sha256sums=('SKIP'
	    '1fe9d38e0a9f32c48522a7d0fba9552ebea293daf27298b8d418aaf8fc004646'
            'SKIP')

prepare() {
  cd ${srcdir}/jna
  patch -Np1 -i ${srcdir}/jna-ant.patch
  patch -Np1 -i ${srcdir}/jna-gcc-10.patch
}

build() {
  cd ${srcdir}/jna/native
  unset CFLAGS LDFLAGS
  ant
}

package() {
  cd ${srcdir}/jna
  mkdir -p ${pkgdir}/usr/lib/libjnidispatch
  install -m755 native/target/native-linux-ppc64le/libjnidispatch.so ${pkgdir}/usr/lib/libjnidispatch/libjnidispatch.so
}
